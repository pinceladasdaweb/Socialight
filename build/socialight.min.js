/*! Socialight 2.0.0 | (c) 2016 Pedro RogÃ©rio | MIT License */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Socialight=b()}(this,function(){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c;if(b=b||0,b>this.length)return-1;for(c=0;c<this.length;c+=1){if(this[c]===a&&c>=b)return c;if(this[c]===a&&b>c)return-1}return-1}),Function.prototype.hasOwnProperty("bind")||(Function.prototype.bind=function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}});var a=function(){return this&&this instanceof a?(this.container=document.querySelectorAll("[data-socialight-url]"),this.channels=["facebook","twitter","linkedin","googleplus","pinterest","buffer"],void this.ready()):new a};return a.prototype={post:function(a,b,c,d){var e=new XMLHttpRequest;e.open("POST",a,!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Content-length",b.length),e.setRequestHeader("Connection","close"),e.onreadystatechange=function(){if(4===this.readyState)if(this.status>=200&&this.status<300||304===this.status){var a=JSON.parse(this.responseText);c.call(this,a)}else d.call(this,this.responseText)},e.send(b),e=null},jsonp:function(a,b,c){var d,e,f,g="jsonp_"+Math.round(1e5*Math.random());d=document.head||document.getElementsByTagName("head")[0],f=document.createElement("script"),f.type="text/javascript",e=f.cloneNode(),e.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+g,e.async=!0,d.appendChild(e),window[g]=function(a){b.call(c||window,a),d.removeChild(e),e=null,delete this.name}.bind(this)},abbrNum:function(a,b){b=Math.pow(10,b);var c,d,e=["k","m","b","t"];for(d=e.length-1;d>=0;d-=1)if(c=Math.pow(10,3*(d+1)),a>=c){a=Math.round(a*b/c)/b,1e3===a&&d<e.length-1&&(a=1,d+=1),a+=e[d];break}return a},each:function(a,b){for(var c=0,d=a.length;d>c;)b(a[c],c),c+=1},isInArray:function(a,b){return a.indexOf(b)>=0},isJson:function(a){try{var b=JSON.parse(a);if(b&&"object"==typeof b&&null!==b)return b}catch(c){console.log('%c You must pass a valid JSON in attribute "data-socialight-url". View a example here: https://github.com/pinceladasdaweb/Socialight/blob/master/example/index.html#L27',"background: red; color: white")}return!1},template:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a=a.replace(new RegExp("{"+c+"}","g"),b[c]));return a},getAttributes:function(a){return{url:encodeURIComponent(a.parentNode.getAttribute("data-socialight-url")),title:encodeURIComponent(a.parentNode.getAttribute("data-socialight-title")),text:encodeURIComponent(a.parentNode.getAttribute("data-socialight-text")),image:encodeURIComponent(a.parentNode.getAttribute("data-socialight-image"))}},popup:function(a){a.addEventListener("click",function(a){a.preventDefault(),a.target&&"A"===a.target.nodeName&&window.open(a.target.href,"","toolbar=0,status=0,scrollbars=0,width=680,height=480")})},createChannels:function(){var a,b,c,d,e,f,g;for(d=0,g=this.container.length;g>d;d+=1)for(a=this.isJson(this.container[d].getAttribute("data-socialight-channels")),b=this.container[d].getAttribute("data-socialight-url"),this.popup(this.container[d]),e=0,f=a.length;f>e;e+=1)this.isInArray(this.channels,a[e])&&(c=this.template('<a data-socialight-channel="{channel}" data-socialight-url="{url}"></a>',{channel:a[e],url:b}),this.container[d].insertAdjacentHTML("beforeend",c))},facebook:function(){var a,b=document.querySelectorAll('[data-socialight-channel="facebook"]');this.each(b,function(b){a=this.getAttributes(b),b.setAttribute("href","https://www.facebook.com/sharer/sharer.php?u="+a.url),this.jsonp("https://graph.facebook.com/?id="+a.url,function(a){b.textContent=this.abbrNum(a.shares,1)}.bind(this))}.bind(this))},twitter:function(){var a,b=document.querySelectorAll('[data-socialight-channel="twitter"]');this.each(b,function(b){a=this.getAttributes(b),b.setAttribute("href","https://twitter.com/share?url="+a.url+"&text="+a.title),b.textContent="Tweet"}.bind(this))},googlePlus:function(){var a,b,c=document.querySelectorAll('[data-socialight-channel="googleplus"]');this.each(c,function(c){a=this.getAttributes(c),b=JSON.stringify({method:"pos.plusones.get",id:decodeURIComponent(a.url),params:{nolog:!0,id:decodeURIComponent(a.url),source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}),c.setAttribute("href","https://plus.google.com/share?url="+a.url),this.post("https://clients6.google.com/rpc",b,function(a){c.textContent=this.abbrNum(a.result.metadata.globalCounts.count,1)}.bind(this),function(a){console.log(a)})}.bind(this))},linkedin:function(){var a,b=document.querySelectorAll('[data-socialight-channel="linkedin"]');this.each(b,function(b){a=this.getAttributes(b),b.setAttribute("href","https://www.linkedin.com/shareArticle?mini=true&url="+a.url+"&title="+a.title+"&summary="+a.text+"&source="+a.image),this.jsonp("https://www.linkedin.com/countserv/count/share?url="+a.url,function(a){b.textContent=this.abbrNum(a.count,1)}.bind(this))}.bind(this))},buffer:function(){var a,b=document.querySelectorAll('[data-socialight-channel="buffer"]');this.each(b,function(b){a=this.getAttributes(b),b.setAttribute("href","https://buffer.com/add?url="+a.url+"&text="+a.title),this.jsonp("https://api.bufferapp.com/1/links/shares.json?url="+a.url,function(a){b.textContent=this.abbrNum(a.shares,1)}.bind(this))}.bind(this))},pinterest:function(){var a,b=document.querySelectorAll('[data-socialight-channel="pinterest"]');this.each(b,function(b){a=this.getAttributes(b),b.setAttribute("href","https://pinterest.com/pin/create/button/?url="+a.url+"&media="+a.image+"&description="+a.title),this.jsonp("https://api.pinterest.com/v1/urls/count.json?&url="+a.url,function(a){b.textContent=this.abbrNum(a.count,1)}.bind(this))}.bind(this))},getCounters:function(){this.facebook(),this.twitter(),this.googlePlus(),this.linkedin(),this.buffer(),this.pinterest()},ready:function(){this.createChannels(),this.getCounters()}},a});